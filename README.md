## Описание данных
Данные содержат информацию о взаимодействии пользователей с диджитал каналами Спортмастера (мобильное приложение, сайт) в период **с 01.06.2024 по 21.06.2024**. Датасет содержит информацию по этапам воронки продаж (клики на карточку товара, добавления в корзину, оформление заказа). За основу взяты clickstream данные пользователей, собранные с диджитал каналов Спортмастера (сайт, мобильное приложение).
## Этапы анализа
### 1. Exploratory Data Analysis
**Цель этапа:** быстро понять структуру и качество данных, привести датасет к удобному для анализа виду и получить базовые метрики.  
Т.к. датасет довольно большой, нужно оптимизировать работу с памятью. Для этого: 
- Считываю только часть датасета (все столбцы и первые 1 млн строк), чтобы проверить структуру колонок и типы данных. Эта часть весит 536.5 MB.
- Изменяю типы данных, уменьшаю разрядность. Заодно обрабатываю пустые строки в столбцах с флагами (product_is_pick_up, product_is_pick_point, product_is_delivery, product_is_now), пишу там 0, затем изменяю эти столбцы в булевый тип. После этих действий размер данных уменьшился в 4 раза (с 536.5 MB до 123.0 MB для 1 млн строк).
- Далее обрабатываю оставшуюся часть датасета. 
**Расчет ключевых метрик**
В период с 01.06.2024 по 21.06.2024 было совершено **7 млн событий** от **2,1 млн уникальных пользователей**. На одного пользователя в среднем приходится около 3 действий.
Распределение пользователей по устройствам:
•	**Android**: 988,227 пользователей (**46.9%**)
•	**Desktop**: 513,053 пользователей (**24.3%**)
•	**iOS**: 649,363 пользователей (**30.8%**)
Из 2,1 млн пользователей 628 тыс. положили товар в корзину (**конверсия в корзину составила 29,8%**), а оформили заказ 207 тыс. пользователей (**конверсия в заказ составила 9,8%**).  
[Здесь](https://github.com/vydrinapolina/SM_Lab_sales_funnel/blob/main/user_metrics.ipynb) представлен полный расчет метрик, связанных с пользователями, а также их визуализация.  
А [здесь](https://github.com/vydrinapolina/SM_Lab_sales_funnel/blob/main/product_metrics.ipynb) проанализирован ассортимент товаров по категориям, по сегментам премиальности, по полу и возрасту.

### 2. Research Question и продуктовые гипотезы
---
Что ограничивает конверсию пользователей из просмотров карточек товаров в оформление заказа, и какие факторы сильнее всего влияют на переходы между этапами воронки?
---
Гипотезы:  
**1) Доступность товара повышает вероятность добавления в корзину и оформления заказа.**  
Если товар доступен «сейчас» или с доставкой/самовывозом, пользователю проще завершить покупку. Поэтому ожидается, что товары с флагами ```product_is_delivery``` / ```product_is_pick_up``` / ```product_is_pick_point``` / ```product_is_now``` будут иметь более высокие конверсии на этапах ```view/add_to_cart``` и ```add_to_cart/order```. При этом эффект может смешиваться с другими факторами: ценой, категорией товара, премиальностью бренда, типом устройства или авторизацией пользователя.  
**2) Авторизация повышает конверсию.**  
Насколько сам факт авторизации влияет на вероятность покупки при прочих равных условиях? Возможно, авторизованные пользователи просто чаще заходят с мобильного приложения, просматривают товары, но покупок не совершают. Гипотеза проверяет, влияет ли сам факт авторизации на вероятность покупки.  
**3) Наличие скидки увеличивает конверсию в корзину, но не влияет на конверсию в заказ.**  
Скидка делает товар привлекательным, поэтому пользователи чаще добавляют в корзину, но если товар низкой маржинальности / имеется низкая мотивация, корзины могут не доводиться до оплаты (dropoff в checkout). Если гипотеза верна, то увидим рост ```view/add_to_cart``` при росте скидки, но слабое изменение или снижение ```add_to_cart/order```.  
**4) Dropoff на разных этапах воронки на разных устройствах отличается.**  
Пользовательский опыт отличается между desktop, android и IOS: интерфейс, скорость работы, удобство оплаты, стабильность приложения и др. Ожидается, что мобильные устройства имеют больший трафик, но потенциально больший dropoff на этапе оформления заказа (из-за менее удобных форм ввода данных/оплаты), а desktop может иметь меньший трафик, но выше конверсию в заказ.  
**5) Премиальность бренда влияет на пользовательское поведение и конверсии.**
Для категорий товаров «обувь» и «одежда» бренд является значимым фактором выбора. Товары премиальных брендов (```brand_lvl``` 0-1) показывают более низкую конверсию из просмотра в корзину, но более высокую конверсию из корзины в заказ по сравнению с товарами масс-маркет брендов (```brand_lvl``` 2).  
**6) Время суток влияет на конверсии и поведение пользователей.**  
В вечерние часы пользователи чаще просматривают товары и добавляют их в корзину, поэтому конверсия в корзину в вечернее время будет выше остальных. В дневные часы, наоборот, выше доля пользователей, готовых оформить заказ, что выражается в более высокой конверсии из корзины в заказ. Если гипотеза верна, вечером можно тестировать триггеры, напоминающие о брошенных корзинах, а днем — ускорять и упрощать процесс оплаты.  

### 3. Проверка [гипотезы 1](https://github.com/vydrinapolina/SM_Lab_sales_funnel/blob/main/hypothesis1.ipynb)

**Основная гипотеза ($H_1$):**  
Доступные товары (```product_is_now``` / ```product_is_delivery``` / ```product_is_pick_up``` / ```product_is_pick_point```), имеют более высокие конверсии из просмотра в корзину и из корзины в заказ.  
**Альтернативная ($H_0$):**  
Наличие флагов доступности не влияет на вероятность добавления в корзину или оформления заказа.  

Для начала гипотеза была проверена по общему признаку доступности, то есть если хотя бы один из флагов был ```True```, то товар считался доступным.  
Расчет конверсий доступных и недоступных товаров представлен на графике ниже. **Конверсия в заказ у недоступных товаров выше на 3%**, что вызывает некоторые вопросы.   
Чтобы убедиться, что различия конверсий между доступными и недоступными товарами статистически значимы, был проведен z-test по пропорциям (```from statsmodels.stats.proportion import proportions_ztest```).  
Итак, различия статистически значимы, $p-value < 0.05$.
<img width="546" height="270" alt="image" src="https://github.com/user-attachments/assets/dffb82b6-0f1c-4777-836b-5033df37f80e" />

Нужно разобраться, почему конверсия в заказ у недоступных товаров выше. Поэтому проанализируем конверсии отдельно по каждому устройству и по категориям товаров.  

**Конверсии по устройствам** показаны на графиках, а статистическая значимость различий была также проверена с помощью z-теста.  
Тут ситуация такая же: конверсия в заказ у недоступных товаров выше по всем устройствам. Однако, по результатам z-теста различия в конверсиях в заказ на компьютере статистически не значимо ($p-value > 0.05$).  
<img width="754" height="307" alt="image" src="https://github.com/user-attachments/assets/b507e671-6870-4a71-aebc-a29cb3a32ca7" />

Аналогично показаны **конверсии по категориям товаров**, а также проверена статистическая значимость различий с помощью z-теста. Здесь все различия статистически значимы.  
<img width="760" height="298" alt="image" src="https://github.com/user-attachments/assets/ec60d456-9b2b-4ade-805a-a82140fd405e" />

На данном этапе можно заключить, что **доступность товара статистически значимо повышает вероятность добавления в корзину**.   
При переходе от корзины к заказу эффект доступности оказывается неоднородным.   
Таким образом, **первая часть гипотезы полностью подтверждается**: пользователи чаще взаимодействуют с доступными товарами на ранних этапах воронки.  

**Почему конверсия в заказ у недоступных товаров в категориях «одежда» и «обувь» выше?**   
Скорее всего, это связано с уровнем премиальности товара. Пользователи желают купить определенный товар премиального бренда (особенно это будет выражено в категории «обувь», так как летом повышенный спрос на кроссовки и кеды), поэтому если этого товара нет в наличии, то покупатели будут оформлять предзаказ. 
Этим фактом можно объяснить так же то, что конверсия в корзину у недоступных товаров в мобильных приложениях выше, так как пользователи используют уведомления о поступлении товара и «лист ожидания». Проверим это предположение.  

Рассчитаем **конверсии по уровню бренда**, значимость различий проверим с помощью z-теста. Результаты представлены на графиках, все различия статистически значимы.
<img width="801" height="316" alt="image" src="https://github.com/user-attachments/assets/3978d821-7b35-40c6-9547-c2c0685c2ae0" />

**Доступность товара статистически значимо увеличивает вероятность добавления в корзину для всех типов брендов**.  
**Для бюджетных брендов доступность товара также увеличивает вероятность заказа**, однако для премиальных брендов (0 и 1) недоступные товары чаще доводят до заказа.  
Покупатели готовы ждать редкие или дефицитные вещи, ставят уведомления в мобильном приложении и совершают заказ, как только появляется возможность.  

Чтобы окончательно подтвердить это предположение, **проверим авторизацию пользователей**. Если пользователь ждёт поступления — он почти наверняка авторизован.  
**Сфокусируемся только на премиальных товарах категорий «одежда» и «обувь», взаимодействие с которыми происходило в мобильных приложениях**, рассчитаем конверсии в корзину и в заказ для авторизованных и неавторизованных пользователей.  
<img width="773" height="318" alt="image" src="https://github.com/user-attachments/assets/c732c70a-3bae-4542-9bee-06e5c275a884" />

Проверим значимость различий с помощью z-теста. Для этого сделаем отдельных 4 теста:  
**Тест 1:** сравнивает конверсию в заказ **авторизованных** и **неавторизованных** пользователей для **недоступных** товаров. Различие статистически значимо. Авторизованные пользователи действительно чаще доводят до заказа недоступные товары.  
**Тест 2:** сравнивает конверсию в заказ **авторизованных** и **неавторизованных** пользователей для **доступных** товаров. Различие статистически значимо. Авторизованные пользователи доводят до заказа доступные товары чаще, чем неавторизованные.  
**Тест 3:** сравнивает конверсию в заказ **авторизованных** пользователей между доступными и недоступными товарами. Различие статистически значимо. Авторизованные пользователи чаще оформляют заказ на недоступные товары.  
**Тест 4:** сравнивает конверсию в заказ **неавторизованных** пользователей между доступными и недоступными товарами. Разница между конверсией в заказ доступных товаров и конверсией в заказ недоступных товаров неавторизованных пользователей статистически не значимо.  

**Вывод:**  
Гипотеза о том, что доступность товара повышает вероятность добавления в корзину, полностью подтвердилась. Пользователи статистически значимо чаще добавляют в корзину товары, которые можно получить сейчас, доставкой или самовывозом.  
Однако влияние доступности на конверсию из корзины в заказ оказалось неоднозначным. Для товаров масс-маркет (```brand_lvl``` 2) доступность также повышает вероятность заказа, а для премиальных брендов (```brand_lvl``` 0–1) наблюдается обратная тенденция: недоступные товары категорий «одежда» и «обувь» чаще доводятся до заказа. Это связано с поведением авторизованных пользователей, которые готовы ждать поступления определенных моделей, используют функции уведомлений о поступлении и оформляют предзаказы через мобильные приложения.   
Таким образом, доступность является важным фактором на ранних этапах воронки, но на финальном этапе её роль опосредована другими факторами: премиальностью бренда, авторизацией пользователя и типом устройства.  

## Бизнес-рекомендации
На основе проведённого анализа можно предложить следующие рекомендации для повышения конверсии и улучшения пользовательского опыта:  
1. **Добавить явные метки доступности товара**  
   * Для товаров масс-маркет активно выделять наличие флагов доставки, самовывоза или возможности получить сейчас — это повысит конверсию как в корзину, так и в заказ  
   * Для премиальных товаров добавить возможность оформления предзаказа и настроить уведомления о поступлении. Это особенно важно в категориях «одежда» и «обувь», где спрос на конкретные модели высок  
   * Исследовать возможность предоплат для предзаказов, чтобы снизить риск отмен   
2. **Стимулировать авторизацию пользователей**  
   * Добавить авторизацию через соцсети  
   * Внедрить триггерные сообщения для неавторизованных пользователей, добавляющих в корзину премиальные товары, с предложением об авторизации  
3. **Оптимизировать конверсии в заказ на мобильных устройствах**, добавив уведомления о брошенных корзинах в вечернее время, когда активность добавления в корзину максимальна.

## Источник данных  
[SM Lab: воронка онлайн-продаж](https://dano.hse.ru/data2024?ysclid=mi17o22mv3745083093)


